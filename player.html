<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Quiz 90s — Jogador</title>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <style>
    :root{--fg:#0f0;--bg:#000;--border:#0f0}
    *{box-sizing:border-box} html,body{height:100%}
    body{background:var(--bg);color:var(--fg);font-family:'Press Start 2P',monospace;}
    .wrap{min-height:100%;display:grid;grid-template-rows:auto 1fr auto;gap:1rem;padding:2vh 4vw}
    header{text-align:center}
    h1{font-size:clamp(20px,6vw,32px)}
    .card{border:2px solid var(--border);border-radius:16px;padding:4vw}
    input,button{font-family:inherit}
    input{width:100%;padding:1rem;border:2px solid var(--border);border-radius:12px;background:transparent;color:var(--fg);font-size:clamp(16px,4.5vw,20px)}
    .btn{width:100%;margin-top:1rem;border:2px solid var(--border);background:transparent;color:var(--fg);padding:1rem;border-radius:12px;font-size:clamp(16px,5vw,22px)}
    .btn:hover{background:var(--fg);color:#000}
    #question{font-size:clamp(18px,5.5vw,26px);text-align:center}
    #options{display:grid;gap:1rem;margin-top:1rem}
    .opt{padding:1rem;border:2px solid var(--border);border-radius:14px;text-align:center}
    #error{display:none;margin-top:1rem;color:#fff;background:#c00;padding:1rem;border-radius:12px;font-size:clamp(12px,4vw,18px)}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>🎮 Quiz 90s</h1>
    </header>

    <main>
      <section id="login" class="card">
        <p style="text-align:center;margin-bottom:.5rem">Digite seu nome:</p>
        <input id="playerName" placeholder="Seu nome" autocomplete="off" />
        <button id="enter" class="btn">Entrar</button>
      </section>

      <section id="game" class="card" style="display:none;">
        <h2 id="question">Aguardando pergunta…</h2>
        <div id="options"></div>
        <p id="feedback" style="text-align:center;margin-top:1rem"></p>
        <div id="error"></div>
      </section>
    </main>

    <footer style="text-align:center;opacity:.8"><small>Dica: mantenha esta aba ativa durante o jogo.</small></footer>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import { getDatabase, ref, onValue, push } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

    const showError = (msg) => {
      const e = document.getElementById('error');
      e.textContent = "⚠️ " + msg;
      e.style.display = 'block';
      console.error(msg);
    };

    const firebaseConfig = {
      apiKey: "AIzaSyDffGKwazMR-P2Bb6459T7IrT_gehEdjwo",
      authDomain: "works-63725.firebaseapp.com",
      projectId: "works-63725",
      databaseURL: "https://works-63725-default-rtdb.firebaseio.com",
      storageBucket: "works-63725.firebasestorage.app",
      messagingSenderId: "314958421674",
      appId: "1:314958421674:web:b5db4802ef3a0375d37ad3",
      measurementId: "G-4V14Z21393"
    };

    let app, db;
    try {
      app = initializeApp(firebaseConfig);
      db  = getDatabase(app);
    } catch (err) {
      showError("Erro ao iniciar Firebase: " + err.message);
    }

    let playerName = "", answered=false;
    const elLogin=document.getElementById('login');
    const elGame=document.getElementById('game');
    const elQ=document.getElementById('question');
    const elOpts=document.getElementById('options');
    const elFb=document.getElementById('feedback');

    document.getElementById('enter').onclick=()=>{
      playerName=document.getElementById('playerName').value.trim();
      if(!playerName){ alert('Digite um nome para entrar.'); return; }
      elLogin.style.display='none';
      elGame.style.display='block';
    };

    onValue(ref(db,'currentQuestion'), snap=>{
      const q=snap.val(); if(!q) return;
      answered=false; elFb.textContent='';
      elQ.textContent=q.question; elOpts.innerHTML='';
      q.options.forEach((opt,i)=>{
        const b=document.createElement('button');
        b.className='opt'; b.textContent=opt;
        b.onclick=()=>{ if(answered) return; answered=true; push(ref(db,'answers'),{player:playerName,option:i,qIndex:q.index}); elFb.textContent='Resposta enviada! Aguarde o resultado...'; };
        elOpts.appendChild(b);
      });
      // Se o host já liberou os resultados, mostrar feedback imediatamente
      if(q.show){
        showCorrectAnswer(q);
      }
    });

    function showCorrectAnswer(q){
      elFb.textContent = "Resposta correta: " + q.options[q.answer];
    }

    // Escuta quando o host libera resultados
    onValue(ref(db,'currentQuestion/show'), snap=>{
      if(snap.val()){
        getDatabaseAnswer();
      }
    });

    function getDatabaseAnswer(){
      onValue(ref(db,'currentQuestion'), snap=>{
        const q=snap.val();
        if(q) showCorrectAnswer(q);
      }, {onlyOnce:true});
    }

    onValue(ref(db,'gameOver'), snap=>{
      if(snap.val()){
        elFb.textContent='Fim de jogo! Veja o ranking no HOST.';
        elOpts.innerHTML='';
      }
    });
  </script>
</body>
</html>
