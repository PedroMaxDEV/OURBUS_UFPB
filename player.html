<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Quiz 90s ‚Äî Jogador</title>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <style>
    :root{--fg:#0f0;--bg:#000;--border:#0f0}
    *{box-sizing:border-box} html,body{height:100%}
    body{background:var(--bg);color:var(--fg);font-family:'Press Start 2P',monospace;}
    .wrap{min-height:100%;display:grid;grid-template-rows:auto 1fr auto;gap:1rem;padding:2vh 4vw}
    header{text-align:center}
    h1{font-size:clamp(20px,6vw,32px)}
    .card{border:2px solid var(--border);border-radius:16px;padding:4vw}
    input,button{font-family:inherit}
    input{width:100%;padding:1rem;border:2px solid var(--border);border-radius:12px;background:transparent;color:var(--fg);font-size:clamp(16px,4.5vw,20px)}
    .btn{width:100%;margin-top:1rem;border:2px solid var(--border);background:transparent;color:var(--fg);padding:1rem;border-radius:12px;font-size:clamp(16px,5vw,22px)}
    .btn:hover{background:var(--fg);color:#000}
    #question{font-size:clamp(18px,5.5vw,26px);text-align:center}
    #options{display:grid;gap:1rem;margin-top:1rem}
    .opt{padding:1rem;border:2px solid var(--border);border-radius:14px;text-align:center}
    #bars div{margin:.5rem 0}
    #ranking p{margin:.3rem 0}
    #error{display:none;margin-top:1rem;color:#fff;background:#c00;padding:1rem;border-radius:12px;font-size:clamp(12px,4vw,18px)}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>üéÆ Quiz 90s</h1>
    </header>

    <main>
      <section id="login" class="card">
        <p style="text-align:center;margin-bottom:.5rem">Digite seu nome:</p>
        <input id="playerName" placeholder="Seu nome" autocomplete="off" />
        <button id="enter" class="btn">Entrar</button>
      </section>

      <section id="game" class="card" style="display:none;">
        <h2 id="question">Aguardando pergunta‚Ä¶</h2>
        <div id="options"></div>
        <p id="feedback" style="text-align:center;margin-top:1rem"></p>
        <div id="results" style="display:none;">
          <h3 style="text-align:center">Resultado</h3>
          <div id="bars"></div>
        </div>
        <div id="ranking" style="display:none;">
          <h3 style="text-align:center">üèÜ Ranking Final</h3>
          <div id="rankList"></div>
        </div>
        <div id="error"></div>
      </section>
    </main>

    <footer style="text-align:center;opacity:.8"><small>Dica: mantenha esta aba ativa durante o jogo.</small></footer>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import { getDatabase, ref, onValue, push } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDffGKwazMR-P2Bb6459T7IrT_gehEdjwo",
      authDomain: "works-63725.firebaseapp.com",
      projectId: "works-63725",
      databaseURL: "https://works-63725-default-rtdb.firebaseio.com",
      storageBucket: "works-63725.firebasestorage.app",
      messagingSenderId: "314958421674",
      appId: "1:314958421674:web:b5db4802ef3a0375d37ad3",
      measurementId: "G-4V14Z21393"
    };

    const app = initializeApp(firebaseConfig);
    const db  = getDatabase(app);

    let playerName = "", answered=false;
    const elLogin=document.getElementById('login');
    const elGame=document.getElementById('game');
    const elQ=document.getElementById('question');
    const elOpts=document.getElementById('options');
    const elFb=document.getElementById('feedback');

    document.getElementById('enter').onclick=()=>{
      playerName=document.getElementById('playerName').value.trim();
      if(!playerName){ alert('Digite um nome para entrar.'); return; }
      elLogin.style.display='none';
      elGame.style.display='block';
    };

    let currentQuestion = null;

    onValue(ref(db,'currentQuestion'), snap=>{
      const q=snap.val(); if(!q) return;
      currentQuestion=q;
      answered=false; elFb.textContent='';
      elQ.textContent=q.question; elOpts.innerHTML='';
      document.getElementById('results').style.display='none';
      q.options.forEach((opt,i)=>{
        const b=document.createElement('button');
        b.className='opt'; b.textContent=opt;
        b.onclick=()=>{ 
          if(answered) return; 
          answered=true; 
          push(ref(db,'answers'),{player:playerName,option:i,qIndex:q.index}); 
          elFb.textContent='Resposta enviada! Aguarde o resultado...'; 
        };
        elOpts.appendChild(b);
      });
    });

    onValue(ref(db,'results'), snap=>{
      const data=snap.val(); if(!data||!currentQuestion) return;
      const r = data[currentQuestion.index]; if(!r) return;
      document.getElementById('results').style.display='block';
      const bars=document.getElementById('bars');
      bars.innerHTML = r.map(x=>`
        <div>
          <strong>${x.text}</strong> ‚Äî ${x.pct}% ${x.correct?"‚úÖ":""}
          <div style="background:#0f05;height:14px;border:1px solid var(--border);border-radius:6px;overflow:hidden">
            <div style="background:var(--fg);width:${x.pct}%;height:100%"></div>
          </div>
        </div>
      `).join('');
    });

    onValue(ref(db,'gameOver'), snap=>{
      if(snap.val()){
        elFb.textContent='Fim de jogo!';
        document.getElementById('ranking').style.display='block';
        onValue(ref(db,'scores'), sc=>{
          const data=sc.val()||{};
          const list=Object.entries(data).sort((a,b)=>b[1]-a[1]);
          document.getElementById('rankList').innerHTML=list.map(([n,p])=>`<p>${n}: ${p}</p>`).join('');
        });
      }
    });
  </script>
</body>
</html>